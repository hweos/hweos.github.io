"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6506],{5615:e=>{e.exports=JSON.parse('{"permalink":"/blog/websocket-guide","editUrl":"https://github.com/hweos/git-pages/edit/main/blog/2024-09-10-websocket.md","source":"@site/blog/2024-09-10-websocket.md","title":"WebSocket \u5b9e\u65f6\u901a\u4fe1\u6307\u5357","description":"WebSocket \u5b9e\u73b0\u4e86\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u5168\u53cc\u5de5\u901a\u4fe1\u3002\u672c\u6587\u4ecb\u7ecd WebSocket \u7684\u539f\u7406\u548c\u5b9e\u8df5\u3002","date":"2024-09-10T00:00:00.000Z","tags":[{"inline":true,"label":"WebSocket","permalink":"/blog/tags/web-socket"},{"inline":true,"label":"\u5b9e\u65f6\u901a\u4fe1","permalink":"/blog/tags/\u5b9e\u65f6\u901a\u4fe1"},{"inline":true,"label":"\u540e\u7aef","permalink":"/blog/tags/\u540e\u7aef"}],"readingTime":4.8,"hasTruncateMarker":true,"authors":[{"name":"Mason","title":"Full Stack Developer","url":"https://github.com/HuangZhe007","socials":{"github":"https://github.com/HuangZhe007"},"imageURL":"https://avatars.githubusercontent.com/u/45168628?v=4","key":"mason","page":null}],"frontMatter":{"slug":"websocket-guide","title":"WebSocket \u5b9e\u65f6\u901a\u4fe1\u6307\u5357","authors":"mason","tags":["WebSocket","\u5b9e\u65f6\u901a\u4fe1","\u540e\u7aef"]},"unlisted":false,"prevItem":{"title":"\u524d\u7aef\u76d1\u63a7\u4e0e\u57cb\u70b9\u5b9e\u8df5","permalink":"/blog/frontend-monitoring"},"nextItem":{"title":"Monorepo \u5b9e\u8df5\u6307\u5357","permalink":"/blog/monorepo-guide"}}')},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var s=t(6540);const o={},r=s.createContext(o);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},8812:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var s=t(5615),o=t(4848),r=t(8453);const a={slug:"websocket-guide",title:"WebSocket \u5b9e\u65f6\u901a\u4fe1\u6307\u5357",authors:"mason",tags:["WebSocket","\u5b9e\u65f6\u901a\u4fe1","\u540e\u7aef"]},c=void 0,i={authorsImageUrls:[void 0]},l=[{value:"\ud83c\udfaf WebSocket \u7b80\u4ecb",id:"-websocket-\u7b80\u4ecb",level:2},{value:"vs HTTP",id:"vs-http",level:3},{value:"\u9002\u7528\u573a\u666f",id:"\u9002\u7528\u573a\u666f",level:3},{value:"\ud83d\udd0c \u5ba2\u6237\u7aef API",id:"-\u5ba2\u6237\u7aef-api",level:2},{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528",level:3},{value:"\u8fde\u63a5\u72b6\u6001",id:"\u8fde\u63a5\u72b6\u6001",level:3},{value:"\ud83d\udee0\ufe0f \u5c01\u88c5 WebSocket",id:"\ufe0f-\u5c01\u88c5-websocket",level:2},{value:"\u5e26\u91cd\u8fde\u7684 WebSocket",id:"\u5e26\u91cd\u8fde\u7684-websocket",level:3},{value:"\ud83d\udda5\ufe0f \u670d\u52a1\u7aef\u5b9e\u73b0",id:"\ufe0f-\u670d\u52a1\u7aef\u5b9e\u73b0",level:2},{value:"Node.js (ws \u5e93)",id:"nodejs-ws-\u5e93",level:3},{value:"\u5e26\u8ba4\u8bc1\u7684\u8fde\u63a5",id:"\u5e26\u8ba4\u8bc1\u7684\u8fde\u63a5",level:3},{value:"\ud83d\udcac \u804a\u5929\u5ba4\u793a\u4f8b",id:"-\u804a\u5929\u5ba4\u793a\u4f8b",level:2},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef",level:3},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef",level:3},{value:"\u2764\ufe0f \u5fc3\u8df3\u68c0\u6d4b",id:"\ufe0f-\u5fc3\u8df3\u68c0\u6d4b",level:2},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef-1",level:3},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef-1",level:3},{value:"\ud83d\udd27 React Hook",id:"-react-hook",level:2},{value:"\ud83d\udccb \u6700\u4f73\u5b9e\u8df5",id:"-\u6700\u4f73\u5b9e\u8df5",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"WebSocket \u5b9e\u73b0\u4e86\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u5168\u53cc\u5de5\u901a\u4fe1\u3002\u672c\u6587\u4ecb\u7ecd WebSocket \u7684\u539f\u7406\u548c\u5b9e\u8df5\u3002"}),"\n",(0,o.jsx)(n.h2,{id:"-websocket-\u7b80\u4ecb",children:"\ud83c\udfaf WebSocket \u7b80\u4ecb"}),"\n",(0,o.jsx)(n.h3,{id:"vs-http",children:"vs HTTP"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"\u7279\u6027"}),(0,o.jsx)(n.th,{children:"HTTP"}),(0,o.jsx)(n.th,{children:"WebSocket"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"\u8fde\u63a5"}),(0,o.jsx)(n.td,{children:"\u77ed\u8fde\u63a5"}),(0,o.jsx)(n.td,{children:"\u957f\u8fde\u63a5"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"\u901a\u4fe1\u65b9\u5f0f"}),(0,o.jsx)(n.td,{children:"\u8bf7\u6c42-\u54cd\u5e94"}),(0,o.jsx)(n.td,{children:"\u5168\u53cc\u5de5"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"\u5f00\u9500"}),(0,o.jsx)(n.td,{children:"\u6bcf\u6b21\u8bf7\u6c42\u90fd\u6709\u5934\u90e8"}),(0,o.jsx)(n.td,{children:"\u4e00\u6b21\u63e1\u624b\uff0c\u540e\u7eed\u5f00\u9500\u5c0f"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"\u5b9e\u65f6\u6027"}),(0,o.jsx)(n.td,{children:"\u8f6e\u8be2"}),(0,o.jsx)(n.td,{children:"\u5b9e\u65f6\u63a8\u9001"})]})]})]}),"\n",(0,o.jsx)(n.h3,{id:"\u9002\u7528\u573a\u666f",children:"\u9002\u7528\u573a\u666f"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-markdown",children:"- \u5373\u65f6\u804a\u5929\n- \u5728\u7ebf\u6e38\u620f\n- \u5b9e\u65f6\u534f\u4f5c\uff08\u6587\u6863\u3001\u767d\u677f\uff09\n- \u80a1\u7968\u884c\u60c5\n- \u6d88\u606f\u63a8\u9001\n- \u5b9e\u65f6\u76d1\u63a7\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"-\u5ba2\u6237\u7aef-api",children:"\ud83d\udd0c \u5ba2\u6237\u7aef API"}),"\n",(0,o.jsx)(n.h3,{id:"\u57fa\u672c\u4f7f\u7528",children:"\u57fa\u672c\u4f7f\u7528"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"// \u521b\u5efa\u8fde\u63a5\nconst ws = new WebSocket('wss://example.com/socket');\n\n// \u8fde\u63a5\u6210\u529f\nws.onopen = () => {\n  console.log('\u8fde\u63a5\u6210\u529f');\n  ws.send('Hello Server!');\n};\n\n// \u63a5\u6536\u6d88\u606f\nws.onmessage = (event) => {\n  console.log('\u6536\u5230\u6d88\u606f:', event.data);\n};\n\n// \u8fde\u63a5\u5173\u95ed\nws.onclose = (event) => {\n  console.log('\u8fde\u63a5\u5173\u95ed:', event.code, event.reason);\n};\n\n// \u9519\u8bef\u5904\u7406\nws.onerror = (error) => {\n  console.error('WebSocket \u9519\u8bef:', error);\n};\n\n// \u53d1\u9001\u6d88\u606f\nws.send('Hello');\nws.send(JSON.stringify({ type: 'message', data: 'Hello' }));\n\n// \u5173\u95ed\u8fde\u63a5\nws.close();\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u8fde\u63a5\u72b6\u6001",children:"\u8fde\u63a5\u72b6\u6001"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"// WebSocket.readyState\nWebSocket.CONNECTING  // 0 - \u8fde\u63a5\u4e2d\nWebSocket.OPEN        // 1 - \u5df2\u8fde\u63a5\nWebSocket.CLOSING     // 2 - \u5173\u95ed\u4e2d\nWebSocket.CLOSED      // 3 - \u5df2\u5173\u95ed\n\n// \u68c0\u67e5\u72b6\u6001\nif (ws.readyState === WebSocket.OPEN) {\n  ws.send(message);\n}\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"\ufe0f-\u5c01\u88c5-websocket",children:"\ud83d\udee0\ufe0f \u5c01\u88c5 WebSocket"}),"\n",(0,o.jsx)(n.h3,{id:"\u5e26\u91cd\u8fde\u7684-websocket",children:"\u5e26\u91cd\u8fde\u7684 WebSocket"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"class ReconnectingWebSocket {\n  private ws: WebSocket | null = null;\n  private url: string;\n  private reconnectAttempts = 0;\n  private maxReconnectAttempts = 5;\n  private reconnectInterval = 1000;\n  private listeners: Map<string, Function[]> = new Map();\n\n  constructor(url: string) {\n    this.url = url;\n    this.connect();\n  }\n\n  private connect() {\n    this.ws = new WebSocket(this.url);\n\n    this.ws.onopen = () => {\n      console.log('WebSocket \u8fde\u63a5\u6210\u529f');\n      this.reconnectAttempts = 0;\n      this.emit('open');\n    };\n\n    this.ws.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      this.emit('message', data);\n    };\n\n    this.ws.onclose = () => {\n      console.log('WebSocket \u8fde\u63a5\u5173\u95ed');\n      this.emit('close');\n      this.reconnect();\n    };\n\n    this.ws.onerror = (error) => {\n      console.error('WebSocket \u9519\u8bef:', error);\n      this.emit('error', error);\n    };\n  }\n\n  private reconnect() {\n    if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n      console.log('\u8fbe\u5230\u6700\u5927\u91cd\u8fde\u6b21\u6570');\n      return;\n    }\n\n    this.reconnectAttempts++;\n    const delay = this.reconnectInterval * Math.pow(2, this.reconnectAttempts - 1);\n    \n    console.log(`${delay}ms \u540e\u5c1d\u8bd5\u91cd\u8fde (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\n    \n    setTimeout(() => this.connect(), delay);\n  }\n\n  send(data: any) {\n    if (this.ws?.readyState === WebSocket.OPEN) {\n      this.ws.send(JSON.stringify(data));\n    } else {\n      console.warn('WebSocket \u672a\u8fde\u63a5');\n    }\n  }\n\n  on(event: string, callback: Function) {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, []);\n    }\n    this.listeners.get(event)!.push(callback);\n  }\n\n  private emit(event: string, data?: any) {\n    this.listeners.get(event)?.forEach(cb => cb(data));\n  }\n\n  close() {\n    this.maxReconnectAttempts = 0; // \u7981\u6b62\u91cd\u8fde\n    this.ws?.close();\n  }\n}\n\n// \u4f7f\u7528\nconst ws = new ReconnectingWebSocket('wss://example.com/socket');\n\nws.on('message', (data) => {\n  console.log('\u6536\u5230:', data);\n});\n\nws.send({ type: 'subscribe', channel: 'updates' });\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"\ufe0f-\u670d\u52a1\u7aef\u5b9e\u73b0",children:"\ud83d\udda5\ufe0f \u670d\u52a1\u7aef\u5b9e\u73b0"}),"\n",(0,o.jsx)(n.h3,{id:"nodejs-ws-\u5e93",children:"Node.js (ws \u5e93)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const WebSocket = require('ws');\n\nconst wss = new WebSocket.Server({ port: 8080 });\n\n// \u5b58\u50a8\u6240\u6709\u8fde\u63a5\nconst clients = new Set();\n\nwss.on('connection', (ws) => {\n  console.log('\u65b0\u8fde\u63a5');\n  clients.add(ws);\n\n  // \u63a5\u6536\u6d88\u606f\n  ws.on('message', (message) => {\n    const data = JSON.parse(message);\n    console.log('\u6536\u5230:', data);\n\n    // \u5e7f\u64ad\u7ed9\u6240\u6709\u5ba2\u6237\u7aef\n    broadcast(data);\n  });\n\n  // \u8fde\u63a5\u5173\u95ed\n  ws.on('close', () => {\n    console.log('\u8fde\u63a5\u5173\u95ed');\n    clients.delete(ws);\n  });\n\n  // \u53d1\u9001\u6b22\u8fce\u6d88\u606f\n  ws.send(JSON.stringify({ type: 'welcome', message: 'Hello!' }));\n});\n\nfunction broadcast(data) {\n  clients.forEach(client => {\n    if (client.readyState === WebSocket.OPEN) {\n      client.send(JSON.stringify(data));\n    }\n  });\n}\n\nconsole.log('WebSocket \u670d\u52a1\u5668\u8fd0\u884c\u5728 ws://localhost:8080');\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u5e26\u8ba4\u8bc1\u7684\u8fde\u63a5",children:"\u5e26\u8ba4\u8bc1\u7684\u8fde\u63a5"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const WebSocket = require('ws');\nconst jwt = require('jsonwebtoken');\n\nconst wss = new WebSocket.Server({ port: 8080 });\n\nwss.on('connection', (ws, req) => {\n  // \u4ece URL \u83b7\u53d6 token\n  const url = new URL(req.url, 'http://localhost');\n  const token = url.searchParams.get('token');\n\n  try {\n    const user = jwt.verify(token, process.env.JWT_SECRET);\n    ws.user = user;\n    console.log(`\u7528\u6237 ${user.name} \u5df2\u8fde\u63a5`);\n  } catch (err) {\n    ws.close(1008, 'Invalid token');\n    return;\n  }\n\n  ws.on('message', (message) => {\n    // \u5904\u7406\u6d88\u606f...\n  });\n});\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"-\u804a\u5929\u5ba4\u793a\u4f8b",children:"\ud83d\udcac \u804a\u5929\u5ba4\u793a\u4f8b"}),"\n",(0,o.jsx)(n.h3,{id:"\u670d\u52a1\u7aef",children:"\u670d\u52a1\u7aef"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const rooms = new Map(); // roomId -> Set<WebSocket>\n\nwss.on('connection', (ws) => {\n  ws.on('message', (message) => {\n    const data = JSON.parse(message);\n\n    switch (data.type) {\n      case 'join':\n        joinRoom(ws, data.room);\n        break;\n      case 'leave':\n        leaveRoom(ws, data.room);\n        break;\n      case 'message':\n        broadcastToRoom(data.room, {\n          type: 'message',\n          user: ws.user,\n          content: data.content,\n          timestamp: Date.now()\n        });\n        break;\n    }\n  });\n\n  ws.on('close', () => {\n    // \u79bb\u5f00\u6240\u6709\u623f\u95f4\n    rooms.forEach((clients, roomId) => {\n      clients.delete(ws);\n    });\n  });\n});\n\nfunction joinRoom(ws, roomId) {\n  if (!rooms.has(roomId)) {\n    rooms.set(roomId, new Set());\n  }\n  rooms.get(roomId).add(ws);\n  ws.rooms = ws.rooms || new Set();\n  ws.rooms.add(roomId);\n}\n\nfunction leaveRoom(ws, roomId) {\n  rooms.get(roomId)?.delete(ws);\n  ws.rooms?.delete(roomId);\n}\n\nfunction broadcastToRoom(roomId, data) {\n  rooms.get(roomId)?.forEach(client => {\n    if (client.readyState === WebSocket.OPEN) {\n      client.send(JSON.stringify(data));\n    }\n  });\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u5ba2\u6237\u7aef",children:"\u5ba2\u6237\u7aef"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const ws = new WebSocket('wss://example.com/chat?token=xxx');\n\n// \u52a0\u5165\u623f\u95f4\nws.send(JSON.stringify({ type: 'join', room: 'general' }));\n\n// \u53d1\u9001\u6d88\u606f\nfunction sendMessage(content) {\n  ws.send(JSON.stringify({\n    type: 'message',\n    room: 'general',\n    content\n  }));\n}\n\n// \u63a5\u6536\u6d88\u606f\nws.onmessage = (event) => {\n  const data = JSON.parse(event.data);\n  if (data.type === 'message') {\n    displayMessage(data);\n  }\n};\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"\ufe0f-\u5fc3\u8df3\u68c0\u6d4b",children:"\u2764\ufe0f \u5fc3\u8df3\u68c0\u6d4b"}),"\n",(0,o.jsx)(n.h3,{id:"\u5ba2\u6237\u7aef-1",children:"\u5ba2\u6237\u7aef"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"class WebSocketWithHeartbeat {\n  private heartbeatInterval: number = 30000;\n  private heartbeatTimer?: NodeJS.Timer;\n\n  connect() {\n    this.ws = new WebSocket(this.url);\n    \n    this.ws.onopen = () => {\n      this.startHeartbeat();\n    };\n\n    this.ws.onclose = () => {\n      this.stopHeartbeat();\n    };\n\n    this.ws.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      if (data.type === 'pong') {\n        // \u6536\u5230\u5fc3\u8df3\u54cd\u5e94\n        return;\n      }\n      // \u5904\u7406\u5176\u4ed6\u6d88\u606f...\n    };\n  }\n\n  private startHeartbeat() {\n    this.heartbeatTimer = setInterval(() => {\n      if (this.ws?.readyState === WebSocket.OPEN) {\n        this.ws.send(JSON.stringify({ type: 'ping' }));\n      }\n    }, this.heartbeatInterval);\n  }\n\n  private stopHeartbeat() {\n    if (this.heartbeatTimer) {\n      clearInterval(this.heartbeatTimer);\n    }\n  }\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u670d\u52a1\u7aef-1",children:"\u670d\u52a1\u7aef"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"wss.on('connection', (ws) => {\n  ws.isAlive = true;\n\n  ws.on('message', (message) => {\n    const data = JSON.parse(message);\n    if (data.type === 'ping') {\n      ws.send(JSON.stringify({ type: 'pong' }));\n      return;\n    }\n    // \u5904\u7406\u5176\u4ed6\u6d88\u606f...\n  });\n\n  ws.on('pong', () => {\n    ws.isAlive = true;\n  });\n});\n\n// \u5b9a\u671f\u68c0\u67e5\u8fde\u63a5\nsetInterval(() => {\n  wss.clients.forEach((ws) => {\n    if (!ws.isAlive) {\n      return ws.terminate();\n    }\n    ws.isAlive = false;\n    ws.ping();\n  });\n}, 30000);\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"-react-hook",children:"\ud83d\udd27 React Hook"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { useEffect, useRef, useState, useCallback } from 'react';\n\ninterface UseWebSocketOptions {\n  onMessage?: (data: any) => void;\n  onOpen?: () => void;\n  onClose?: () => void;\n  onError?: (error: Event) => void;\n  reconnect?: boolean;\n}\n\nexport function useWebSocket(url: string, options: UseWebSocketOptions = {}) {\n  const [isConnected, setIsConnected] = useState(false);\n  const wsRef = useRef<WebSocket | null>(null);\n\n  const connect = useCallback(() => {\n    const ws = new WebSocket(url);\n\n    ws.onopen = () => {\n      setIsConnected(true);\n      options.onOpen?.();\n    };\n\n    ws.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      options.onMessage?.(data);\n    };\n\n    ws.onclose = () => {\n      setIsConnected(false);\n      options.onClose?.();\n      if (options.reconnect) {\n        setTimeout(connect, 3000);\n      }\n    };\n\n    ws.onerror = (error) => {\n      options.onError?.(error);\n    };\n\n    wsRef.current = ws;\n  }, [url, options]);\n\n  useEffect(() => {\n    connect();\n    return () => wsRef.current?.close();\n  }, [connect]);\n\n  const send = useCallback((data: any) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(data));\n    }\n  }, []);\n\n  return { isConnected, send };\n}\n\n// \u4f7f\u7528\nfunction Chat() {\n  const [messages, setMessages] = useState([]);\n  \n  const { isConnected, send } = useWebSocket('wss://example.com/chat', {\n    onMessage: (data) => {\n      setMessages(prev => [...prev, data]);\n    },\n    reconnect: true\n  });\n\n  return (\n    <div>\n      <div>\u72b6\u6001: {isConnected ? '\u5df2\u8fde\u63a5' : '\u672a\u8fde\u63a5'}</div>\n      <button onClick={() => send({ type: 'message', content: 'Hello' })}>\n        \u53d1\u9001\n      </button>\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"-\u6700\u4f73\u5b9e\u8df5",children:"\ud83d\udccb \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-markdown",children:"1. \u4f7f\u7528 wss:// (\u52a0\u5bc6)\n2. \u5b9e\u73b0\u91cd\u8fde\u673a\u5236\n3. \u6dfb\u52a0\u5fc3\u8df3\u68c0\u6d4b\n4. \u6d88\u606f\u4f7f\u7528 JSON \u683c\u5f0f\n5. \u5904\u7406\u8fde\u63a5\u72b6\u6001\n6. \u8003\u8651\u79bb\u7ebf\u6d88\u606f\u961f\u5217\n7. \u670d\u52a1\u7aef\u5b9e\u73b0\u9650\u6d41\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.p,{children:"WebSocket \u662f\u5b9e\u65f6\u5e94\u7528\u7684\u57fa\u7840\u3002\u7406\u89e3\u5176\u539f\u7406\uff0c\u5408\u7406\u5c01\u88c5\uff0c\u80fd\u591f\u6784\u5efa\u6d41\u7545\u7684\u5b9e\u65f6\u4f53\u9a8c\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);