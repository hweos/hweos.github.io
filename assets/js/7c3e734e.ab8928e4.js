"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2654],{57:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"devops/github-actions","title":"GitHub Actions \u5165\u95e8","description":"GitHub Actions \u662f GitHub \u63d0\u4f9b\u7684 CI/CD \u5e73\u53f0\uff0c\u53ef\u4ee5\u81ea\u52a8\u5316\u6784\u5efa\u3001\u6d4b\u8bd5\u548c\u90e8\u7f72\u3002","source":"@site/docs/devops/github-actions.md","sourceDirName":"devops","slug":"/devops/github-actions","permalink":"/docs/devops/github-actions","draft":false,"unlisted":false,"editUrl":"https://github.com/hweos/git-pages/edit/main/docs/devops/github-actions.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Docker Compose \u5b9e\u8df5","permalink":"/docs/devops/docker-compose"},"next":{"title":"Misc","permalink":"/docs/category/misc"}}');var l=s(4848),i=s(8453);const r={},c="GitHub Actions \u5165\u95e8",d={},o=[{value:"\u6838\u5fc3\u6982\u5ff5",id:"\u6838\u5fc3\u6982\u5ff5",level:2},{value:"\u5feb\u901f\u5f00\u59cb",id:"\u5feb\u901f\u5f00\u59cb",level:2},{value:"\u7b2c\u4e00\u4e2a Workflow",id:"\u7b2c\u4e00\u4e2a-workflow",level:3},{value:"\u89e6\u53d1\u5668 (Events)",id:"\u89e6\u53d1\u5668-events",level:2},{value:"\u5e38\u7528\u89e6\u53d1\u5668",id:"\u5e38\u7528\u89e6\u53d1\u5668",level:3},{value:"\u8def\u5f84\u8fc7\u6ee4",id:"\u8def\u5f84\u8fc7\u6ee4",level:3},{value:"Jobs \u914d\u7f6e",id:"jobs-\u914d\u7f6e",level:2},{value:"\u57fa\u672c\u914d\u7f6e",id:"\u57fa\u672c\u914d\u7f6e",level:3},{value:"\u77e9\u9635\u7b56\u7565",id:"\u77e9\u9635\u7b56\u7565",level:3},{value:"\u6761\u4ef6\u6267\u884c",id:"\u6761\u4ef6\u6267\u884c",level:3},{value:"Job \u4f9d\u8d56",id:"job-\u4f9d\u8d56",level:3},{value:"Job \u8f93\u51fa",id:"job-\u8f93\u51fa",level:3},{value:"\u5e38\u7528 Actions",id:"\u5e38\u7528-actions",level:2},{value:"Checkout",id:"checkout",level:3},{value:"Setup Node.js",id:"setup-nodejs",level:3},{value:"\u7f13\u5b58",id:"\u7f13\u5b58",level:3},{value:"\u4e0a\u4f20/\u4e0b\u8f7d\u5236\u54c1",id:"\u4e0a\u4f20\u4e0b\u8f7d\u5236\u54c1",level:3},{value:"Secrets \u7ba1\u7406",id:"secrets-\u7ba1\u7406",level:2},{value:"\u8bbe\u7f6e Secrets",id:"\u8bbe\u7f6e-secrets",level:3},{value:"\u4f7f\u7528 Secrets",id:"\u4f7f\u7528-secrets",level:3},{value:"\u73af\u5883 Secrets",id:"\u73af\u5883-secrets",level:3},{value:"\u5b9e\u6218\u793a\u4f8b",id:"\u5b9e\u6218\u793a\u4f8b",level:2},{value:"\u5b8c\u6574 CI \u6d41\u7a0b",id:"\u5b8c\u6574-ci-\u6d41\u7a0b",level:3},{value:"\u81ea\u52a8\u90e8\u7f72\u5230 Vercel",id:"\u81ea\u52a8\u90e8\u7f72\u5230-vercel",level:3},{value:"Docker \u6784\u5efa\u5e76\u63a8\u9001",id:"docker-\u6784\u5efa\u5e76\u63a8\u9001",level:3},{value:"SSH \u90e8\u7f72",id:"ssh-\u90e8\u7f72",level:3},{value:"\u53d1\u5e03 npm \u5305",id:"\u53d1\u5e03-npm-\u5305",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u4f7f\u7528\u56fa\u5b9a\u7248\u672c",id:"1-\u4f7f\u7528\u56fa\u5b9a\u7248\u672c",level:3},{value:"2. \u5e76\u884c\u6267\u884c",id:"2-\u5e76\u884c\u6267\u884c",level:3},{value:"3. \u590d\u7528 Workflow",id:"3-\u590d\u7528-workflow",level:3},{value:"4. \u8d85\u65f6\u8bbe\u7f6e",id:"4-\u8d85\u65f6\u8bbe\u7f6e",level:3},{value:"\u8c03\u8bd5\u6280\u5de7",id:"\u8c03\u8bd5\u6280\u5de7",level:2},{value:"\u542f\u7528\u8c03\u8bd5\u65e5\u5fd7",id:"\u542f\u7528\u8c03\u8bd5\u65e5\u5fd7",level:3},{value:"\u4f7f\u7528 tmate \u8c03\u8bd5",id:"\u4f7f\u7528-tmate-\u8c03\u8bd5",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function a(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"github-actions-\u5165\u95e8",children:"GitHub Actions \u5165\u95e8"})}),"\n",(0,l.jsx)(e.p,{children:"GitHub Actions \u662f GitHub \u63d0\u4f9b\u7684 CI/CD \u5e73\u53f0\uff0c\u53ef\u4ee5\u81ea\u52a8\u5316\u6784\u5efa\u3001\u6d4b\u8bd5\u548c\u90e8\u7f72\u3002"}),"\n",(0,l.jsx)(e.h2,{id:"\u6838\u5fc3\u6982\u5ff5",children:"\u6838\u5fc3\u6982\u5ff5"}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u6982\u5ff5"}),(0,l.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Workflow"}),(0,l.jsxs)(e.td,{children:["\u81ea\u52a8\u5316\u6d41\u7a0b\uff0c\u5b9a\u4e49\u5728 ",(0,l.jsx)(e.code,{children:".github/workflows/*.yml"})]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Event"}),(0,l.jsx)(e.td,{children:"\u89e6\u53d1 Workflow \u7684\u4e8b\u4ef6\uff08push\u3001PR\u3001\u5b9a\u65f6\u7b49\uff09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Job"}),(0,l.jsx)(e.td,{children:"\u4e00\u7ec4\u6b65\u9aa4\uff0c\u8fd0\u884c\u5728\u540c\u4e00\u4e2a Runner \u4e0a"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Step"}),(0,l.jsx)(e.td,{children:"Job \u4e2d\u7684\u5355\u4e2a\u4efb\u52a1"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Action"}),(0,l.jsx)(e.td,{children:"\u53ef\u590d\u7528\u7684\u64cd\u4f5c\u5355\u5143"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Runner"}),(0,l.jsx)(e.td,{children:"\u6267\u884c Job \u7684\u670d\u52a1\u5668"})]})]})]}),"\n",(0,l.jsx)(e.h2,{id:"\u5feb\u901f\u5f00\u59cb",children:"\u5feb\u901f\u5f00\u59cb"}),"\n",(0,l.jsx)(e.h3,{id:"\u7b2c\u4e00\u4e2a-workflow",children:"\u7b2c\u4e00\u4e2a Workflow"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"# .github/workflows/ci.yml\nname: CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    \n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n      \n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n      \n      - name: Install dependencies\n        run: npm ci\n      \n      - name: Run tests\n        run: npm test\n      \n      - name: Build\n        run: npm run build\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u89e6\u53d1\u5668-events",children:"\u89e6\u53d1\u5668 (Events)"}),"\n",(0,l.jsx)(e.h3,{id:"\u5e38\u7528\u89e6\u53d1\u5668",children:"\u5e38\u7528\u89e6\u53d1\u5668"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"on:\n  # \u63a8\u9001\u65f6\u89e6\u53d1\n  push:\n    branches:\n      - main\n      - 'release/**'\n    paths:\n      - 'src/**'\n      - 'package.json'\n    paths-ignore:\n      - '**.md'\n      - 'docs/**'\n  \n  # PR \u65f6\u89e6\u53d1\n  pull_request:\n    branches: [main]\n    types: [opened, synchronize, reopened]\n  \n  # \u5b9a\u65f6\u89e6\u53d1 (cron)\n  schedule:\n    - cron: '0 2 * * *'  # \u6bcf\u5929 UTC 2:00\n  \n  # \u624b\u52a8\u89e6\u53d1\n  workflow_dispatch:\n    inputs:\n      environment:\n        description: 'Deploy environment'\n        required: true\n        default: 'staging'\n        type: choice\n        options:\n          - staging\n          - production\n  \n  # \u53d1\u5e03\u65f6\u89e6\u53d1\n  release:\n    types: [published]\n  \n  # \u5176\u4ed6 workflow \u5b8c\u6210\u540e\u89e6\u53d1\n  workflow_run:\n    workflows: [Build]\n    types: [completed]\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u8def\u5f84\u8fc7\u6ee4",children:"\u8def\u5f84\u8fc7\u6ee4"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"on:\n  push:\n    paths:\n      - 'src/**'\n      - 'package.json'\n    paths-ignore:\n      - '**.md'\n"})}),"\n",(0,l.jsx)(e.h2,{id:"jobs-\u914d\u7f6e",children:"Jobs \u914d\u7f6e"}),"\n",(0,l.jsx)(e.h3,{id:"\u57fa\u672c\u914d\u7f6e",children:"\u57fa\u672c\u914d\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"jobs:\n  build:\n    name: Build Application\n    runs-on: ubuntu-latest\n    timeout-minutes: 10\n    \n    steps:\n      - uses: actions/checkout@v4\n      - run: npm ci\n      - run: npm run build\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u77e9\u9635\u7b56\u7565",children:"\u77e9\u9635\u7b56\u7565"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"jobs:\n  test:\n    runs-on: ${{ matrix.os }}\n    strategy:\n      matrix:\n        os: [ubuntu-latest, windows-latest, macos-latest]\n        node: [18, 20, 22]\n        exclude:\n          - os: windows-latest\n            node: 18\n        include:\n          - os: ubuntu-latest\n            node: 20\n            coverage: true\n      fail-fast: false\n    \n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: ${{ matrix.node }}\n      - run: npm test\n      - if: matrix.coverage\n        run: npm run coverage\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u6761\u4ef6\u6267\u884c",children:"\u6761\u4ef6\u6267\u884c"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"jobs:\n  deploy:\n    if: github.ref == 'refs/heads/main'\n    runs-on: ubuntu-latest\n    steps:\n      - run: echo \"Deploying...\"\n  \n  notify:\n    needs: deploy\n    if: always() && needs.deploy.result == 'failure'\n    runs-on: ubuntu-latest\n    steps:\n      - run: echo \"Deploy failed, sending notification...\"\n"})}),"\n",(0,l.jsx)(e.h3,{id:"job-\u4f9d\u8d56",children:"Job \u4f9d\u8d56"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"jobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - run: npm run build\n  \n  test:\n    needs: build\n    runs-on: ubuntu-latest\n    steps:\n      - run: npm test\n  \n  deploy:\n    needs: [build, test]\n    runs-on: ubuntu-latest\n    steps:\n      - run: npm run deploy\n"})}),"\n",(0,l.jsx)(e.h3,{id:"job-\u8f93\u51fa",children:"Job \u8f93\u51fa"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'jobs:\n  build:\n    runs-on: ubuntu-latest\n    outputs:\n      version: ${{ steps.version.outputs.value }}\n    steps:\n      - id: version\n        run: echo "value=$(node -p "require(\'./package.json\').version")" >> $GITHUB_OUTPUT\n  \n  deploy:\n    needs: build\n    runs-on: ubuntu-latest\n    steps:\n      - run: echo "Deploying version ${{ needs.build.outputs.version }}"\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u5e38\u7528-actions",children:"\u5e38\u7528 Actions"}),"\n",(0,l.jsx)(e.h3,{id:"checkout",children:"Checkout"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"- uses: actions/checkout@v4\n  with:\n    fetch-depth: 0  # \u83b7\u53d6\u5b8c\u6574\u5386\u53f2\n    token: ${{ secrets.PAT }}  # \u4f7f\u7528 PAT \u8bbf\u95ee\u79c1\u6709\u4ed3\u5e93\n"})}),"\n",(0,l.jsx)(e.h3,{id:"setup-nodejs",children:"Setup Node.js"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"- uses: actions/setup-node@v4\n  with:\n    node-version: '20'\n    node-version-file: '.nvmrc'  # \u6216\u4ece\u6587\u4ef6\u8bfb\u53d6\n    cache: 'npm'  # \u6216 'pnpm', 'yarn'\n    registry-url: 'https://npm.pkg.github.com'\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u7f13\u5b58",children:"\u7f13\u5b58"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"- uses: actions/cache@v4\n  with:\n    path: |\n      ~/.npm\n      node_modules\n    key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}\n    restore-keys: |\n      ${{ runner.os }}-node-\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u4e0a\u4f20\u4e0b\u8f7d\u5236\u54c1",children:"\u4e0a\u4f20/\u4e0b\u8f7d\u5236\u54c1"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"# \u4e0a\u4f20\n- uses: actions/upload-artifact@v4\n  with:\n    name: build-output\n    path: dist/\n    retention-days: 7\n\n# \u4e0b\u8f7d\n- uses: actions/download-artifact@v4\n  with:\n    name: build-output\n    path: dist/\n"})}),"\n",(0,l.jsx)(e.h2,{id:"secrets-\u7ba1\u7406",children:"Secrets \u7ba1\u7406"}),"\n",(0,l.jsx)(e.h3,{id:"\u8bbe\u7f6e-secrets",children:"\u8bbe\u7f6e Secrets"}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u4ed3\u5e93 Settings \u2192 Secrets and variables \u2192 Actions \u4e2d\u6dfb\u52a0\u3002"}),"\n",(0,l.jsx)(e.h3,{id:"\u4f7f\u7528-secrets",children:"\u4f7f\u7528 Secrets"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"jobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Deploy\n        run: ./deploy.sh\n        env:\n          API_KEY: ${{ secrets.API_KEY }}\n          DEPLOY_TOKEN: ${{ secrets.DEPLOY_TOKEN }}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u73af\u5883-secrets",children:"\u73af\u5883 Secrets"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'jobs:\n  deploy:\n    runs-on: ubuntu-latest\n    environment: production  # \u4f7f\u7528 production \u73af\u5883\u7684 secrets\n    steps:\n      - run: echo "Deploying to ${{ vars.DEPLOY_URL }}"\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u5b9e\u6218\u793a\u4f8b",children:"\u5b9e\u6218\u793a\u4f8b"}),"\n",(0,l.jsx)(e.h3,{id:"\u5b8c\u6574-ci-\u6d41\u7a0b",children:"\u5b8c\u6574 CI \u6d41\u7a0b"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"name: CI\n\non:\n  push:\n    branches: [main, develop]\n  pull_request:\n    branches: [main]\n\njobs:\n  lint:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n      - run: npm ci\n      - run: npm run lint\n\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n      - run: npm ci\n      - run: npm test -- --coverage\n      - uses: codecov/codecov-action@v3\n        with:\n          token: ${{ secrets.CODECOV_TOKEN }}\n\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n      - run: npm ci\n      - run: npm run build\n      - uses: actions/upload-artifact@v4\n        with:\n          name: dist\n          path: dist/\n\n  e2e:\n    needs: build\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/download-artifact@v4\n        with:\n          name: dist\n          path: dist/\n      - uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n      - run: npm ci\n      - run: npx playwright install --with-deps\n      - run: npm run test:e2e\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u81ea\u52a8\u90e8\u7f72\u5230-vercel",children:"\u81ea\u52a8\u90e8\u7f72\u5230 Vercel"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"name: Deploy\n\non:\n  push:\n    branches: [main]\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      - name: Deploy to Vercel\n        uses: amondnet/vercel-action@v25\n        with:\n          vercel-token: ${{ secrets.VERCEL_TOKEN }}\n          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}\n          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}\n          vercel-args: '--prod'\n"})}),"\n",(0,l.jsx)(e.h3,{id:"docker-\u6784\u5efa\u5e76\u63a8\u9001",children:"Docker \u6784\u5efa\u5e76\u63a8\u9001"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"name: Docker\n\non:\n  push:\n    tags: ['v*']\n\njobs:\n  build-and-push:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      - name: Set up Docker Buildx\n        uses: docker/setup-buildx-action@v3\n      \n      - name: Login to Docker Hub\n        uses: docker/login-action@v3\n        with:\n          username: ${{ secrets.DOCKERHUB_USERNAME }}\n          password: ${{ secrets.DOCKERHUB_TOKEN }}\n      \n      - name: Extract metadata\n        id: meta\n        uses: docker/metadata-action@v5\n        with:\n          images: myuser/myapp\n          tags: |\n            type=semver,pattern={{version}}\n            type=semver,pattern={{major}}.{{minor}}\n      \n      - name: Build and push\n        uses: docker/build-push-action@v5\n        with:\n          context: .\n          push: true\n          tags: ${{ steps.meta.outputs.tags }}\n          cache-from: type=gha\n          cache-to: type=gha,mode=max\n"})}),"\n",(0,l.jsx)(e.h3,{id:"ssh-\u90e8\u7f72",children:"SSH \u90e8\u7f72"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"name: Deploy via SSH\n\non:\n  push:\n    branches: [main]\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      - name: Deploy\n        uses: appleboy/ssh-action@v1.0.0\n        with:\n          host: ${{ secrets.SSH_HOST }}\n          username: ${{ secrets.SSH_USER }}\n          key: ${{ secrets.SSH_PRIVATE_KEY }}\n          script: |\n            cd /var/www/myapp\n            git pull origin main\n            npm ci\n            npm run build\n            pm2 restart myapp\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u53d1\u5e03-npm-\u5305",children:"\u53d1\u5e03 npm \u5305"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"name: Publish\n\non:\n  release:\n    types: [published]\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      - uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          registry-url: 'https://registry.npmjs.org'\n      \n      - run: npm ci\n      - run: npm run build\n      - run: npm publish\n        env:\n          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,l.jsx)(e.h3,{id:"1-\u4f7f\u7528\u56fa\u5b9a\u7248\u672c",children:"1. \u4f7f\u7528\u56fa\u5b9a\u7248\u672c"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"# \u2705 \u4f7f\u7528\u5177\u4f53\u7248\u672c\n- uses: actions/checkout@v4\n- uses: actions/setup-node@v4\n\n# \u274c \u907f\u514d\n- uses: actions/checkout@main\n"})}),"\n",(0,l.jsx)(e.h3,{id:"2-\u5e76\u884c\u6267\u884c",children:"2. \u5e76\u884c\u6267\u884c"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"jobs:\n  lint:\n    runs-on: ubuntu-latest\n    steps: ...\n  \n  test:\n    runs-on: ubuntu-latest\n    steps: ...\n  \n  build:\n    runs-on: ubuntu-latest\n    steps: ...\n\n  # lint, test, build \u5e76\u884c\u6267\u884c\n  deploy:\n    needs: [lint, test, build]\n    steps: ...\n"})}),"\n",(0,l.jsx)(e.h3,{id:"3-\u590d\u7528-workflow",children:"3. \u590d\u7528 Workflow"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"# .github/workflows/reusable.yml\nname: Reusable Build\n\non:\n  workflow_call:\n    inputs:\n      node-version:\n        required: false\n        type: string\n        default: '20'\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: ${{ inputs.node-version }}\n      - run: npm ci && npm run build\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"# \u8c03\u7528\u53ef\u590d\u7528 workflow\njobs:\n  build:\n    uses: ./.github/workflows/reusable.yml\n    with:\n      node-version: '20'\n"})}),"\n",(0,l.jsx)(e.h3,{id:"4-\u8d85\u65f6\u8bbe\u7f6e",children:"4. \u8d85\u65f6\u8bbe\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"jobs:\n  test:\n    runs-on: ubuntu-latest\n    timeout-minutes: 10\n    steps:\n      - run: npm test\n        timeout-minutes: 5\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u8c03\u8bd5\u6280\u5de7",children:"\u8c03\u8bd5\u6280\u5de7"}),"\n",(0,l.jsx)(e.h3,{id:"\u542f\u7528\u8c03\u8bd5\u65e5\u5fd7",children:"\u542f\u7528\u8c03\u8bd5\u65e5\u5fd7"}),"\n",(0,l.jsx)(e.p,{children:"\u5728 Secrets \u4e2d\u6dfb\u52a0\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"ACTIONS_STEP_DEBUG"}),": ",(0,l.jsx)(e.code,{children:"true"})]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"ACTIONS_RUNNER_DEBUG"}),": ",(0,l.jsx)(e.code,{children:"true"})]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u4f7f\u7528-tmate-\u8c03\u8bd5",children:"\u4f7f\u7528 tmate \u8c03\u8bd5"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"- name: Setup tmate session\n  if: failure()\n  uses: mxschmitt/action-tmate@v3\n  timeout-minutes: 15\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u529f\u80fd"}),(0,l.jsx)(e.th,{children:"\u914d\u7f6e"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u89e6\u53d1\u5668"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"on: push/pull_request/schedule/workflow_dispatch"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u77e9\u9635\u6784\u5efa"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"strategy.matrix"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6761\u4ef6\u6267\u884c"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"if: github.ref == 'refs/heads/main'"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u4f9d\u8d56\u5173\u7cfb"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"needs: [job1, job2]"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u7f13\u5b58"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"actions/cache@v4"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Secrets"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"${{ secrets.NAME }}"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u73af\u5883\u53d8\u91cf"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"env: KEY: value"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5236\u54c1"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"actions/upload-artifact@v4"})})]})]})]})]})}function u(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>r,x:()=>c});var t=s(6540);const l={},i=t.createContext(l);function r(n){const e=t.useContext(i);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:r(n.components),t.createElement(i.Provider,{value:e},n.children)}}}]);