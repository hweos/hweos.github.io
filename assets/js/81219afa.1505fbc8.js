"use strict";(self.webpackChunkts_test=self.webpackChunkts_test||[]).push([[898],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return d}});var r=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var c=r.createContext({}),m=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},u=function(e){var n=m(e.components);return r.createElement(c.Provider,{value:n},e.children)},l={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=m(t),d=i,f=p["".concat(c,".").concat(d)]||p[d]||l[d]||o;return t?r.createElement(f,a(a({ref:n},u),{},{components:t})):r.createElement(f,a({ref:n},u))}));function d(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,a=new Array(o);a[0]=p;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var m=2;m<o;m++)a[m]=t[m];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},8271:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return m},toc:function(){return u},default:function(){return p}});var r=t(7462),i=t(3366),o=(t(7294),t(3905)),a=["components"],s={sidebar_position:1,id:"performance"},c="React \u6027\u80fd\u4f18\u5316",m={unversionedId:"\u6742\u9879/performance",id:"\u6742\u9879/performance",title:"React \u6027\u80fd\u4f18\u5316",description:"\u8df3\u8fc7\u4e0d\u5fc5\u8981\u7684\u7ec4\u4ef6\u66f4\u65b0",source:"@site/docs/\u6742\u9879/React\u6027\u80fd\u4f18\u5316.mdx",sourceDirName:"\u6742\u9879",slug:"/\u6742\u9879/performance",permalink:"/docs/\u6742\u9879/performance",editUrl:"https://github.com/hweos/git-pages/edit/main/docs/\u6742\u9879/React\u6027\u80fd\u4f18\u5316.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,id:"performance"},sidebar:"tutorialSidebar",previous:{title:"Translate your site",permalink:"/docs/tutorial-extras/translate-your-site"},next:{title:"\u7d22\u5f15\u4f18\u5148\u961f\u5217",permalink:"/docs/\u6570\u636e\u7ed3\u6784\u548c\u7b97\u6cd5/\u7d22\u5f15\u4f18\u5148\u961f\u5217"}},u=[{value:"\u8df3\u8fc7\u4e0d\u5fc5\u8981\u7684\u7ec4\u4ef6\u66f4\u65b0",id:"\u8df3\u8fc7\u4e0d\u5fc5\u8981\u7684\u7ec4\u4ef6\u66f4\u65b0",children:[{value:"useMemo\u3001useCallback",id:"usememousecallback",children:[],level:3},{value:"PureComponent \u548c memo",id:"purecomponent-\u548c-memo",children:[{value:"PureComponent \u548c memo \u53ea\u4f1a\u6d45\u6bd4\u8f83 props",id:"purecomponent-\u548c-memo-\u53ea\u4f1a\u6d45\u6bd4\u8f83-props",children:[],level:4}],level:3}],level:2}],l={toc:u};function p(e){var n=e.components,t=(0,i.Z)(e,a);return(0,o.kt)("wrapper",(0,r.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"react-\u6027\u80fd\u4f18\u5316"},"React \u6027\u80fd\u4f18\u5316"),(0,o.kt)("h2",{id:"\u8df3\u8fc7\u4e0d\u5fc5\u8981\u7684\u7ec4\u4ef6\u66f4\u65b0"},"\u8df3\u8fc7\u4e0d\u5fc5\u8981\u7684\u7ec4\u4ef6\u66f4\u65b0"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5728 React \u5de5\u4f5c\u6d41\u4e2d\uff0c\u5982\u679c\u53ea\u6709\u7236\u7ec4\u4ef6\u53d1\u751f\u72b6\u6001\u66f4\u65b0\uff0c\u5373\u4f7f\u7236\u7ec4\u4ef6\u4f20\u7ed9\u5b50\u7ec4\u4ef6\u7684\u6240\u6709 Props \u90fd\u6ca1\u6709\u4fee\u6539\uff0c\u4e5f\u4f1a\u5f15\u8d77\u5b50\u7ec4\u4ef6\u7684 Render \u8fc7\u7a0b\u3002\u4ece React \u7684\u58f0\u660e\u5f0f\u8bbe\u8ba1\u7406\u5ff5\u6765\u770b\uff0c\u5982\u679c\u5b50\u7ec4\u4ef6\u7684 Props \u548c State \u90fd\u6ca1\u6709\u6539\u53d8\uff0c\u90a3\u4e48\u5176\u751f\u6210\u7684 DOM \u7ed3\u6784\u548c\u526f\u4f5c\u7528\u4e5f\u4e0d\u5e94\u8be5\u53d1\u751f\u6539\u53d8\u3002\u5f53\u5b50\u7ec4\u4ef6\u7b26\u5408\u58f0\u660e\u5f0f\u8bbe\u8ba1\u7406\u5ff5\u65f6\uff0c\u5c31\u53ef\u4ee5\u5ffd\u7565\u5b50\u7ec4\u4ef6\u672c\u6b21\u7684 Render \u8fc7\u7a0b\u3002")),(0,o.kt)("h3",{id:"usememousecallback"},"useMemo\u3001useCallback"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live noInline",live:!0,noInline:!0},'const renderMap = {};\n\nrender(function () {\n  const [, refresh] = useState(0);\n  // \u4f7f\u7528 useMemo\n  const memoItem = useMemo(() => {\n    renderMap["memoItem"] = (renderMap["memoItem"] || 0) + 1;\n    return "memoItem";\n  }, []);\n  const item = (() => {\n    renderMap["item"] = (renderMap["item"] || 0) + 1;\n    return "item";\n  })();\n  // \u4f7f\u7528 useCallback\n  const callbackItem = useCallback(() => {\n    return "callbackItem";\n  }, []);\n  const funItem = () => {\n    return "funItem";\n  };\n  useEffect(() => {\n    renderMap["callbackItem"] = (renderMap["callbackItem"] || 0) + 1;\n  }, [callbackItem]);\n  useEffect(() => {\n    renderMap["funItem"] = (renderMap["funItem"] || 0) + 1;\n  }, [funItem]);\n  return (\n    <div>\n      {memoItem}\n      <br />\n      {item}\n      <br />\n      {callbackItem()}\n      <br />\n      {funItem()}\n      <br />\n      <button onClick={() => refresh((i) => ++i)}>update</button>\n      <br />\n      renderMap: {JSON.stringify(renderMap)}\n    </div>\n  );\n});\n')),(0,o.kt)("h3",{id:"purecomponent-\u548c-memo"},"PureComponent \u548c memo"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live noInline",live:!0,noInline:!0},'const renderList = [0, 0];\nconst renderList2 = [0, 0];\n\nfunction Item({ text, index }) {\n  renderList[index] = renderList[index] + 1;\n  return <span>{text}</span>;\n}\n\n// \u4f7f\u7528memo\nconst MemoItem = memo(function ({ text, index }) {\n  renderList2[index] = renderList2[index] + 1;\n  return <span>{text}</span>;\n});\n\nrender(function () {\n  const [state, setState] = useState([1, 1]);\n  return (\n    <div>\n      {state.map((text, index) => (\n        <Item key={index} text={text} index={index} />\n      ))}\n      <br />\n      {/* \u4f7f\u7528memo */}\n      {state.map((text, index) => (\n        <MemoItem key={index + "memo"} text={text} index={index} />\n      ))}\n      <br />\n      <button\n        onClick={() => {\n          setState((list) => {\n            list[1] = list[1] + 1;\n            return [...list];\n          });\n        }}\n      >\n        update\n      </button>\n      <br />\n      renderList: {JSON.stringify(renderList)}\n      <br />\n      renderList2: {JSON.stringify(renderList2)}\n    </div>\n  );\n});\n')),(0,o.kt)("h4",{id:"purecomponent-\u548c-memo-\u53ea\u4f1a\u6d45\u6bd4\u8f83-props"},"PureComponent \u548c memo \u53ea\u4f1a\u6d45\u6bd4\u8f83 props"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live noInline",live:!0,noInline:!0},'const renderList = [0, 0];\nconst renderList2 = [0, 0];\n\nconst Item = memo(({ item, index }) => {\n  renderList[index] = renderList[index] + 1;\n  return <span>{JSON.stringify(item)}</span>;\n});\n// \u4f7f\u7528areEqual\nconst Item2 = memo(\n  ({ item, index }) => {\n    renderList2[index] = renderList2[index] + 1;\n    return <span>{JSON.stringify(item)}</span>;\n  },\n  // \u5199\u81ea\u5df1\u7684\u5224\u65ad\u903b\u8f91\n  (prevProps, nextProps) => prevProps.item.age === nextProps.item.age\n);\n\nrender(function () {\n  const [state, setState] = useState([\n    { name: "\u5f20\u4e09", age: 18 },\n    { name: "\u674e\u56db", age: 19 },\n  ]);\n  return (\n    <div>\n      {state.map((item, index) => {\n        return <Item key={index} item={item} index={index} />;\n      })}\n      <br />\n      {/* \u4f7f\u7528areEqual */}\n      {state.map((item, index) => {\n        return <Item2 key={index + "2"} item={item} index={index} />;\n      })}\n      <br />\n      <button\n        onClick={() => {\n          setState((list) => {\n            const _list = [...list];\n            _list[1] = { ..._list[1], age: _list[1].age + 1 };\n            _list[0] = { ...list[0] };\n            return _list;\n          });\n        }}\n      >\n        update\n      </button>\n      <br />\n      renderList: {JSON.stringify(renderList)}\n      <br />\n      renderList2: {JSON.stringify(renderList2)}\n    </div>\n  );\n});\n')))}p.isMDXComponent=!0}}]);