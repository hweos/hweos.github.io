"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5078],{7420:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"misc/performance","title":"React \u6027\u80fd\u4f18\u5316","description":"\u8df3\u8fc7\u4e0d\u5fc5\u8981\u7684\u7ec4\u4ef6\u66f4\u65b0","source":"@site/docs/misc/react-performance.mdx","sourceDirName":"misc","slug":"/misc/react-performance","permalink":"/docs/misc/react-performance","draft":false,"unlisted":false,"editUrl":"https://github.com/hweos/git-pages/edit/main/docs/misc/react-performance.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"slug":"react-performance","title":"React \u6027\u80fd\u4f18\u5316","id":"performance"},"sidebar":"docsSidebar","previous":{"title":"\u6742\u9879","permalink":"/docs/category/\u6742\u9879"},"next":{"title":"MacBook SSH \u914d\u7f6e\u6307\u5357","permalink":"/docs/misc/ssh-config"}}');var a=t(4848),s=t(8453);const o={sidebar_position:1,slug:"react-performance",title:"React \u6027\u80fd\u4f18\u5316",id:"performance"},i="React \u6027\u80fd\u4f18\u5316",c={},l=[{value:"\u8df3\u8fc7\u4e0d\u5fc5\u8981\u7684\u7ec4\u4ef6\u66f4\u65b0",id:"\u8df3\u8fc7\u4e0d\u5fc5\u8981\u7684\u7ec4\u4ef6\u66f4\u65b0",level:2},{value:"useMemo\u3001useCallback",id:"usememousecallback",level:3},{value:"PureComponent \u548c memo",id:"purecomponent-\u548c-memo",level:3},{value:"PureComponent \u548c memo \u53ea\u4f1a\u6d45\u6bd4\u8f83 props",id:"purecomponent-\u548c-memo-\u53ea\u4f1a\u6d45\u6bd4\u8f83-props",level:4},{value:"\u7f29\u5c0f\u72b6\u6001\u5f71\u54cd\u8303\u56f4",id:"\u7f29\u5c0f\u72b6\u6001\u5f71\u54cd\u8303\u56f4",level:3},{value:"\u72b6\u6001\u4e0b\u79fb",id:"\u72b6\u6001\u4e0b\u79fb",level:4},{value:"\u5185\u5bb9\u63d0\u5347",id:"\u5185\u5bb9\u63d0\u5347",level:4}];function d(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"react-\u6027\u80fd\u4f18\u5316",children:"React \u6027\u80fd\u4f18\u5316"})}),"\n",(0,a.jsx)(n.h2,{id:"\u8df3\u8fc7\u4e0d\u5fc5\u8981\u7684\u7ec4\u4ef6\u66f4\u65b0",children:"\u8df3\u8fc7\u4e0d\u5fc5\u8981\u7684\u7ec4\u4ef6\u66f4\u65b0"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"\u5728 React \u5de5\u4f5c\u6d41\u4e2d\uff0c\u5982\u679c\u53ea\u6709\u7236\u7ec4\u4ef6\u53d1\u751f\u72b6\u6001\u66f4\u65b0\uff0c\u5373\u4f7f\u7236\u7ec4\u4ef6\u4f20\u7ed9\u5b50\u7ec4\u4ef6\u7684\u6240\u6709 Props \u90fd\u6ca1\u6709\u4fee\u6539\uff0c\u4e5f\u4f1a\u5f15\u8d77\u5b50\u7ec4\u4ef6\u7684 Render \u8fc7\u7a0b\u3002\u4ece React \u7684\u58f0\u660e\u5f0f\u8bbe\u8ba1\u7406\u5ff5\u6765\u770b\uff0c\u5982\u679c\u5b50\u7ec4\u4ef6\u7684 Props \u548c State \u90fd\u6ca1\u6709\u6539\u53d8\uff0c\u90a3\u4e48\u5176\u751f\u6210\u7684 DOM \u7ed3\u6784\u548c\u526f\u4f5c\u7528\u4e5f\u4e0d\u5e94\u8be5\u53d1\u751f\u6539\u53d8\u3002\u5f53\u5b50\u7ec4\u4ef6\u7b26\u5408\u58f0\u660e\u5f0f\u8bbe\u8ba1\u7406\u5ff5\u65f6\uff0c\u5c31\u53ef\u4ee5\u5ffd\u7565\u5b50\u7ec4\u4ef6\u672c\u6b21\u7684 Render \u8fc7\u7a0b\u3002"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"usememousecallback",children:"useMemo\u3001useCallback"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-jsx",metastring:"live noInline",live:!0,children:'const renderMap = {};\nfunction setRenderMap(name) {\n  renderMap[name] = (renderMap[name] || 0) + 1;\n}\nrender(function () {\n  const [, refresh] = useState(0);\n  // \u4f7f\u7528 useMemo\n  const memoItem = useMemo(() => {\n    setRenderMap("memoItem");\n    return "memoItem";\n  }, []);\n  const item = (() => {\n    setRenderMap("item");\n    return "item";\n  })();\n  // \u4f7f\u7528 useCallback\n  const callbackItem = useCallback(() => {\n    return "callbackItem";\n  }, []);\n  const funItem = () => {\n    return "funItem";\n  };\n  useEffect(() => {\n    setRenderMap("callbackItem");\n  }, [callbackItem]);\n  useEffect(() => {\n    setRenderMap("funItem");\n  }, [funItem]);\n  return (\n    <div>\n      {memoItem}\n      <br />\n      {item}\n      <br />\n      {callbackItem()}\n      <br />\n      {funItem()}\n      <br />\n      <button onClick={() => refresh((i) => ++i)}>update</button>\n      <br />\n      renderMap: {JSON.stringify(renderMap)}\n    </div>\n  );\n});\n'})}),"\n",(0,a.jsx)(n.h3,{id:"purecomponent-\u548c-memo",children:"PureComponent \u548c memo"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-jsx",metastring:"live noInline",live:!0,children:'const renderMap = {};\n\nfunction setRenderMap(name) {\n  renderMap[name] = (renderMap[name] || 0) + 1;\n}\n\nfunction Item({ text, index }) {\n  setRenderMap(`Item-${index}`);\n  return <span>{text}</span>;\n}\n\n// \u4f7f\u7528memo\nconst MemoItem = memo(function ({ text, index }) {\n  setRenderMap(`MemoItem-${index}`);\n  return <span>{text}</span>;\n});\n\nrender(function () {\n  const [state, setState] = useState([1, 1]);\n  return (\n    <div>\n      {state.map((text, index) => (\n        <Item key={index} text={text} index={index} />\n      ))}\n      <br />\n      {/* \u4f7f\u7528memo */}\n      {state.map((text, index) => (\n        <MemoItem key={index + "memo"} text={text} index={index} />\n      ))}\n      <br />\n      <button\n        onClick={() => {\n          setState((list) => {\n            list[1] = list[1] + 1;\n            return [...list];\n          });\n        }}\n      >\n        update\n      </button>\n      <br />\n      renderMap: {JSON.stringify(renderMap)}\n    </div>\n  );\n});\n'})}),"\n",(0,a.jsx)(n.h4,{id:"purecomponent-\u548c-memo-\u53ea\u4f1a\u6d45\u6bd4\u8f83-props",children:"PureComponent \u548c memo \u53ea\u4f1a\u6d45\u6bd4\u8f83 props"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-jsx",metastring:"live noInline",live:!0,children:'const renderMap = {};\n\nfunction setRenderMap(name) {\n  renderMap[name] = (renderMap[name] || 0) + 1;\n}\n\nconst Item = memo(({ item, index }) => {\n  setRenderMap(`Item-${item.name}`);\n  return <span>{JSON.stringify(item)}</span>;\n});\n// \u4f7f\u7528areEqual\nconst Item2 = memo(\n  ({ item, index }) => {\n    setRenderMap(`Item2-${item.name}`);\n    return <span>{JSON.stringify(item)}</span>;\n  },\n  // \u5199\u81ea\u5df1\u7684\u5224\u65ad\u903b\u8f91\n  (prevProps, nextProps) => prevProps.item.age === nextProps.item.age\n);\n\nrender(function () {\n  const [state, setState] = useState([\n    { name: "\u5f20\u4e09", age: 18 },\n    { name: "\u674e\u56db", age: 19 },\n  ]);\n  return (\n    <div>\n      {state.map((item, index) => {\n        return <Item key={index} item={item} index={index} />;\n      })}\n      <br />\n      {/* \u4f7f\u7528areEqual */}\n      {state.map((item, index) => {\n        return <Item2 key={index + "2"} item={item} index={index} />;\n      })}\n      <br />\n      <button\n        onClick={() => {\n          setState((list) => {\n            const _list = [...list];\n            _list[1] = { ..._list[1], age: _list[1].age + 1 };\n            _list[0] = { ...list[0] };\n            return _list;\n          });\n        }}\n      >\n        update\n      </button>\n      <br />\n      renderMap: {JSON.stringify(renderMap)}\n    </div>\n  );\n});\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u7f29\u5c0f\u72b6\u6001\u5f71\u54cd\u8303\u56f4",children:"\u7f29\u5c0f\u72b6\u6001\u5f71\u54cd\u8303\u56f4"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-jsx",metastring:"live noInline",live:!0,children:'const renderMap = {};\n\nfunction setRenderMap(name) {\n  renderMap[name] = (renderMap[name] || 0) + 1;\n}\n\nfunction Example() {\n  setRenderMap("Example");\n  return <p>\u6211\u662f\u4e00\u4e2a\u65e0\u5173\u7ec4\u4ef6</p>;\n}\n\nrender(function App() {\n  setRenderMap("App");\n  const [color, setColor] = useState("red");\n  return (\n    <div>\n      <input value={color} onChange={(e) => setColor(e.target.value)} />\n      <p style={{ color }}>Hello, world!</p>\n      <Example />\n      renderMap: {JSON.stringify(renderMap)}\n    </div>\n  );\n});\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u6bcf\u5f53 color \u53d1\u751f\u53d8\u5316\u65f6\uff0c\u6211\u4eec\u90fd\u4f1a\u91cd\u65b0\u6e32\u67d3",(0,a.jsx)(n.code,{children:"Example"}),"\u3002"]}),"\n",(0,a.jsx)(n.p,{children:"\u6211\u4eec\u53ef\u4ee5\u7528\u4e0a\u9762\u7684 memo \u6765\u5904\u7406\u8fd9\u4e2a\u4e8b\u60c5\uff0c\u4e0d\u8fc7\u4e0b\u9762\u4ecb\u7ecd\u70b9\u4e0d\u4e00\u6837\u7684"}),"\n",(0,a.jsx)(n.h4,{id:"\u72b6\u6001\u4e0b\u79fb",children:"\u72b6\u6001\u4e0b\u79fb"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-jsx",metastring:"live noInline",live:!0,children:'const renderMap = {};\n\nfunction setRenderMap(name) {\n  renderMap[name] = (renderMap[name] || 0) + 1;\n}\n\nfunction Example() {\n  setRenderMap("Example");\n  return <p>\u6211\u662f\u4e00\u4e2a\u65e0\u5173\u7ec4\u4ef6</p>;\n}\nfunction Input() {\n  const [color, setColor] = useState("red");\n  setRenderMap("Input");\n  return (\n    <>\n      <input value={color} onChange={(e) => setColor(e.target.value)} />\n      <p style={{ color }}>Hello, world!</p>\n      renderMap: {JSON.stringify(renderMap)}\n    </>\n  );\n}\n\nrender(function App() {\n  setRenderMap("App");\n  return (\n    <div>\n      <Input />\n      <Example />\n    </div>\n  );\n});\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u6211\u4eec\u5c06\u5c06 color \u72b6\u6001\u62bd\u53d6\u5230\u65b0\u7ec4\u4ef6\u4e2d\uff0c\u8fd9\u6837 color \u6539\u53d8\u5c31\u4e0d\u4f1a\u5f15\u8d77\u7ec4\u4ef6 ",(0,a.jsx)(n.code,{children:"App"})," \u548c ",(0,a.jsx)(n.code,{children:"Example"})," \u91cd\u65b0 Render \u4e86"]}),"\n",(0,a.jsx)(n.h4,{id:"\u5185\u5bb9\u63d0\u5347",children:"\u5185\u5bb9\u63d0\u5347"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-jsx",metastring:"live noInline",live:!0,children:'const renderMap = {};\n\nfunction setRenderMap(name) {\n  renderMap[name] = (renderMap[name] || 0) + 1;\n}\n\nfunction Example() {\n  setRenderMap("Example");\n  return <p>\u6211\u662f\u4e00\u4e2a\u65e0\u5173\u7ec4\u4ef6</p>;\n}\nfunction BG({ children }) {\n  setRenderMap("BG");\n  const [color, setColor] = useState("red");\n  return (\n    <div style={{ color }}>\n      <input value={color} onChange={(e) => setColor(e.target.value)} />\n      {children}\n      renderMap: {JSON.stringify(renderMap)}\n    </div>\n  );\n}\n\nrender(function App() {\n  setRenderMap("App");\n  return (\n    <BG>\n      <p>Hello, world!</p>\n      <Example />\n    </BG>\n  );\n});\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u5728\u7ec4\u4ef6 App \u7684\u9876\u5c42\u4f7f\u7528\u4e86 color\u3002\n\u5c06 color \u72b6\u6001\u62bd\u53d6\u5230\u65b0\u7ec4\u4ef6\u4e2d\uff0c\u5e76\u63d0\u4f9b\u4e00\u4e2a props \u6765\u7ec4\u5408 ",(0,a.jsx)(n.code,{children:"Example"}),"\u3002"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var r=t(6540);const a={},s=r.createContext(a);function o(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);